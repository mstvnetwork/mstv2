<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24/7 Broadcast Channel</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            width: 100%;
            max-width: 960px;
            background-color: #2c2c2c;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            padding: 20px;
            box-sizing: border-box;
        }
        .video-js {
            width: 100%;
            height: auto; /* Adjust height automatically */
        }
        .program-info {
            margin-top: 20px;
            background-color: #3a3a3a;
            padding: 15px;
            border-radius: 5px;
        }
        .program-info h2 {
            margin-top: 0;
            color: #00bcd4; /* A light blue for emphasis */
        }
        .program-info p {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        .program-info span {
            font-weight: bold;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>24/7 Channel - Live (Simulated)</h1>

        <video
            id="my-video"
            class="video-js vjs-big-play-button vjs-default-skin"
            controls
            preload="auto"
            autoplay
            data-setup="{}"
        >
            <p class="vjs-no-js">
                To view this video please enable JavaScript, and consider upgrading to a
                web browser that
                <a href="https://videojs.com/html5-video-support/" target="_blank"
                    >supports HTML5 video</a
                >
            </p>
        </video>

        <div class="program-info">
            <h2>Now Playing: <span id="current-program-title">Loading...</span></h2>
            <p>Description: <span id="current-program-description"></span></p>
            <p>Scheduled Start: <span id="current-program-start"></span></p>
            <p>Scheduled End: <span id="current-program-end"></span></p>
            <p>Time in Program: <span id="time-in-program"></span></p>
            <p>Next Program: <span id="next-program-title"></span> at <span id="next-program-start"></span></p>
        </div>
    </div>
<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
    const player = videojs('my-video');
    let schedule = [];
    let currentProgramIndex = -1;
    let updateInterval;

    function timeToSeconds(timeStr) {
        if (!timeStr || typeof timeStr !== "string" || !timeStr.includes(":")) {
            console.warn("Invalid time string:", timeStr);
            return 0;
        }
        const [hh, mm] = timeStr.split(":").map(Number);
        return (hh || 0) * 3600 + (mm || 0) * 60;
    }

    function fetchSchedule() {
        fetch("https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/schedule.json")
            .then(res => {
                if (!res.ok) throw new Error(`HTTP error ${res.status}`);
                return res.json();
            })
            .then(data => {
                console.log("Schedule loaded:", data);
                schedule = data;
                startScheduleCheck();
            })
            .catch(err => {
                console.error("Error loading schedule:", err);
                document.getElementById('now-playing').textContent = "Error loading schedule!";
            });
    }

    function startScheduleCheck() {
        clearInterval(updateInterval);
        updateInterval = setInterval(checkSchedule, 5000);
        checkSchedule();
    }

    function checkSchedule() {
        const now = new Date();
        const secondsNow = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

        for (let i = 0; i < schedule.length; i++) {
            const item = schedule[i];
            if (!item || !item.startTime || !item.endTime) {
                console.warn("Skipping invalid item:", item);
                continue;
            }

            const start = timeToSeconds(item.startTime);
            const end = timeToSeconds(item.endTime);

            if (secondsNow >= start && secondsNow < end) {
                if (currentProgramIndex !== i) {
                    currentProgramIndex = i;
                    playItem(item);
                }
                break;
            }
        }
    }

    function playItem(item) {
        const nowPlaying = document.getElementById("now-playing");
        nowPlaying.textContent = item.title || "Untitled";

        if (!item.url || !item.type) {
            console.warn("Invalid item:", item);
            return;
        }

        if (item.type === "hls") {
            player.src({ type: 'application/x-mpegURL', src: item.url });
        } else if (item.type === "youtube" || item.url.includes("youtube")) {
            player.src({ type: 'video/youtube', src: item.url }); // Requires YouTube plugin if used
        } else {
            player.src({ type: 'video/mp4', src: item.url });
        }

        player.play().catch(err => {
            console.warn("Playback error:", err);
        });
    }

    fetchSchedule();
</script>
</body>
</html>
