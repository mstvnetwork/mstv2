<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <meta name="description" content="MSTV Network offers a variety of live TV channels including music, movies, and more. Watch your favorite channels online for free.">
  <meta name="keywords" content="live TV, MSTV Network, free TV, live channels, streaming, music, bollywood, saga music">
  <meta name="robots" content="index, follow">

  <meta property="og:title" content="MSTV Network">
  <meta property="og:description" content="Stream live TV channels including music, movies, and more on MSTV Network.">
  <meta property="og:image" content="https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png">
  <meta property="og:url" content="https://mstvnet.netlify.app/">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="MSTV Network">
  <meta name="twitter:description" content="Stream live TV channels including music, movies and more.">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png">
  <meta name="twitter:url" content="https://mstvnet.netlify.app/">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "MSTV Network",
    "url": "https://mstvnet.netlify.app",
    "publisher": {
      "@type": "Organization",
      "name": "MSTV Network",
      "logo": {
        "@type": "ImageObject",
        "url": "https://raw.githubusercontent.com/mstvnetwork/mstv2/refs/heads/main/Design-Studio-2025-01-20%20(2).png"
      }
    },
    "description": "Stream live TV channels including music, movies and more."
  }
  </script>
  <title>MSTV Network</title>
</head>
<style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      overflow-x: hidden;
      margin: 0;
      padding: 0;
    }
    .title-wrapper {
        text-align: center;
        margin-top: 20px;
    }

    .title {
        font-size: 3em;
        display: inline-block;
        color: #0ff;
        text-shadow: 0 0 20px #0ff;
        animation: pop 1.5s ease-in-out infinite alternate;
        will-change: transform;
    }

    @keyframes pop {
        0% { transform: scale(1); }
        100% { transform: scale(1.05); }
    }

    .scrolling-text-container {
        overflow: hidden;
        white-space: nowrap;
        width: 100%;
        box-sizing: border-box;
        border-top: 1px solid #0ff;
        border-bottom: 1px solid #0ff;
        padding: 10px 0;
        margin: 10px 0;
    }
    .scrolling-text {
        display: inline-block;
        animation: scroll-horizontal 15s linear infinite, scrollColor 5s linear infinite;
        font-size: 1.2em;
        color: #fff;
    }
    @keyframes scroll-horizontal {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
    }
    @keyframes scrollColor {
        0% { color: red; }
        25% { color: green; }
        50% { color: cyan; }
        75% { color: orange; }
        100% { color: red; }
    }
    .search-container {
        display: flex;
        justify-content: center;
        margin: 10px;
        position: relative;
        width: 100%;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }
    .search-container input {
        padding: 10px;
        width: 100%;
        font-size: 1em;
        border-radius: 4px 0 0 4px;
        border: 1px solid #0ff;
        background: #222;
        color: #0ff;
        outline: none;
    }
    .search-container button {
        padding: 10px 15px;
        background: #0ff;
        border: none;
        cursor: pointer;
        border-radius: 0 4px 4px 0;
        font-size: 1.2em;
        color: #111;
    }
    .suggestions {
        position: absolute;
        top: 42px;
        left: 0;
        right: 0;
        background: #222;
        border: 1px solid #0ff;
        border-top: none;
        max-height: 180px;
        overflow-y: auto;
        z-index: 1000;
        border-radius: 0 0 4px 4px;
        display: none;
    }
    .suggestions div {
        padding: 8px 12px;
        cursor: pointer;
        color: #0ff;
    }
    .suggestions div:hover {
        background: #0ff;
        color: #111;
    }
    .categories {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin: 15px;
    }
    .categories button {
        padding: 10px;
        background: #222;
        color: #0ff;
        border: 1px solid #0ff;
        cursor: pointer;
        transition: background 0.3s ease;
        border-radius: 4px;
        min-width: 140px;
        text-align: center;
    }
    .categories button:hover {
        background: #0ff;
        color: #111;
    }
    .channel-logos {
        display: none;
        flex-wrap: nowrap;
        overflow-x: auto;
        background: rgba(0, 0, 0, 0.6);
        padding: 10px;
        gap: 10px;
        margin: 0 15px;
        border-radius: 6px;
    }
    .channel-logos img {
        width: 100px;
        cursor: pointer;
        border: 2px solid #0ff;
        border-radius: 6px;
        transition: transform 0.3s ease;
    }
    .channel-logos img:hover {
        transform: scale(1.1);
    }
    .media-player-container {
        position: relative;
        width: 90%;
        max-width: 960px;
        aspect-ratio: 16 / 9;
        margin: 20px auto;
        border: 5px double #0ff;
        background: #000;
        overflow: hidden;
        border-radius: 10px;
    }

    /* Style for the dynamically created media player (video or iframe) */
    .media-player {
        width: 100%;
        height: 100%;
        aspect-ratio: 16 / 9;
        display: block;
        border: none;
        object-fit: cover;
    }

    #player-wrapper {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* Style for the initial placeholder video */
    #initial-placeholder-video {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Ensures video covers the area */
        display: block; /* Important to ensure it's visible by default */
    }

    .overlay-top-left,
    .overlay-bottom-right {
        position: absolute;
        z-index: 20;
        user-select: none;
        pointer-events: none; /* Allows clicks to pass through overlays */
    }

    .overlay-top-left {
        top: 5px;
        left: 10px;
        background: red;
        color: white;
        padding: 5px 10px;
        font-weight: bold;
        font-family: 'Arial Black', Arial, sans-serif;
        font-size: 0.9em;
        border-radius: 3px;
        box-shadow: 0 0 8px red;
    }

    .overlay-bottom-right {
        bottom: 5px;
        right: 10px;
    }

    .logo-overlay {
        width: 120px; /* Adjust size as needed */
        height: auto;
        max-width: 100%;
        display: block;
        opacity: 0.85;
        z-index: 12;
    }

    /* Optional responsive adjustments */
    @media (max-width: 600px) {
        .logo-overlay {
            width: 80px;
        }

        .overlay-top-left {
            font-size: 0.7em;
            padding: 4px 8px;
        }
    }

    .loading-indicator {
        position: absolute;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #0ff;
        font-size: 1.5em;
        display: none;
        user-select: none;
        font-family: monospace;
        font-weight: bold;
        text-shadow: 0 0 10px #0ff;
        z-index: 15;
    }
    .follow-us {
        text-align: center;
        margin: 10px;
        font-size: 1.1em;
        color: #0ff;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
    }
    .follow-us a {
        color: #0ff;
        text-decoration: none;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .follow-us a svg {
        width: 24px;
        height: 24px;
        fill: #0ff;
        transition: fill 0.3s ease;
    }
    .follow-us a:hover svg {
        fill: #08c;
    }
    .follow-us a:hover {
        text-decoration: underline;
    }
    footer {
        background: #222;
        padding: 20px;
        text-align: center;
        margin-top: 40px;
        font-size: 0.9em;
        color: #ccc;
    }

    @media (min-width: 768px) {
        footer {
            font-size: 0.75em; /* smaller size for larger screens / desktop mode */
        }
    }
    footer h3 {
        background: linear-gradient(90deg, #0ff, #08f, #0ff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 10px #0ff;
        font-weight: bold;
        font-size: 1.2em;
        margin-bottom: 10px;
        animation: shimmer 3s infinite linear;
    }

    @keyframes shimmer {
        0% {
            background-position: -100%;
        }
        100% {
            background-position: 200%;
        }
    }

    footer p.copyright {
        animation: glowText 2s ease-in-out infinite alternate;
        font-weight: bold;
        color: #0ff;
        text-shadow: 0 0 5px #0ff, 0 0 10px #0ff, 0 0 20px #0ff;
    }

    @keyframes glowText {
        0% {
            color: #0ff;
            text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
        }
        100% {
            color: #08f;
            text-shadow: 0 0 10px #08f, 0 0 20px #08f;
        }
    }

    #click-block-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10;
        background: transparent;
        cursor: default;
        display: none;
    }

    /* --- Animated Speaker Icon CSS (Revised) --- */
    #unmute-btn {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 25;
        width: 60px; /* Slightly larger for better visual */
        height: 60px;
        background: #0ff;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.9); /* Stronger glow */
        transition: background 0.3s, transform 0.3s, opacity 0.5s;
        overflow: hidden;
        padding: 0;
        opacity: 1; /* Start visible */
        animation: pulseGlow 1.5s infinite alternate; /* Pulsing glow on load */
    }

    #unmute-btn:hover {
        background: #08c;
        transform: translateX(-50%) scale(1.1);
    }

    /* Speaker icon SVG for better control and animation */
    #unmute-btn svg {
        width: 70%; /* Adjust size of SVG inside button */
        height: 70%;
        fill: #111; /* Icon color */
        transition: transform 0.3s ease;
    }

    /* Animation for waves when unmuted (currently not used as button disappears) */
    #unmute-btn.unmuted svg .wave-path {
        animation: wave-animation 1.5s infinite linear;
    }

    @keyframes wave-animation {
        0%, 100% { opacity: 0; transform: scale(0.5); }
        50% { opacity: 1; transform: scale(1); }
    }

    /* Fade out animation for the button itself */
    @keyframes fadeOutImmediate {
        0% { opacity: 1; transform: translateX(-50%) scale(1); }
        100% { opacity: 0; transform: translateX(-50%) scale(0.8); }
    }

    #unmute-btn.fade-out {
        animation: fadeOutImmediate 0.5s forwards; /* Instant fade out on click */
    }

    #unmute-btn.hidden {
        display: none; /* Completely hide after animation */
    }

    /* Keyframe for initial pulsing glow */
    @keyframes pulseGlow {
        0% { box-shadow: 0 0 10px rgba(0, 255, 255, 0.7); }
        50% { box-shadow: 0 0 25px rgba(0, 255, 255, 1), 0 0 35px rgba(0, 255, 255, 0.8); }
        100% { box-shadow: 0 0 10px rgba(0, 255, 255, 0.7); }
    }
    /* --- END Animated Speaker Icon CSS --- */

</style>
<body>

<div class="title-wrapper">
  <span class="title">MSTV NETWORK</span>
</div>

  <div class="scrolling-text-container">
    <div class="scrolling-text">
      Under devolpment please wait Under devolpment please wait Under devolpment please wait Under devolpment please wait...
    </div>
  </div>

  <div class="search-container">
    <input type="text" id="channel-search" placeholder="Search channels..." autocomplete="off" />
    <button onclick="searchSelected()">🔍</button>
    <div id="suggestions" class="suggestions"></div>
  </div>

  <div class="categories" id="categories-container">
    </div>

  <div id="channel-logos" class="channel-logos">
    </div>

 <div class="media-player-container" id="media-player-container">
  <div class="overlay-top-left">MSTV NETWORK</div>
  <div class="overlay-bottom-right">
    <img src="logo.png" class="logo-overlay" alt="MSTV Logo" />
  </div>

  <div id="loading" class="loading-indicator">Loading...</div>

  <div id="player-wrapper">
    <video
      id="initial-placeholder-video"
      class="media-player"
      autoplay
      loop
      muted
      playsinline
      preload="auto"
      poster="https://via.placeholder.com/960x540?text=Loading+MSTV+Network"
    >
      <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" type="video/mp4" />
      Your browser does not support the video tag.
    </video>
  </div>

  <div id="click-block-overlay"></div> 
  <button id="unmute-btn" onclick="toggleMute()">
    <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9v6h4l5 5V4l-5 5H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.98 7-4.66 7-8.77s-2.99-7.79-7-8.77z"/>
        <path class="wave-path" d="M0 0h24v24H0z" fill="none"/> </svg>
  </button>

</div>


  <div class="follow-us">
    <a href="https://www.facebook.com/YourPage" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Facebook">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M22.675 0H1.325C.593 0 0 .593 0 1.326v21.348C0 23.406.593 24 1.325 24H12.82v-9.294H9.692v-3.622h3.128V8.41c0-3.1 1.894-4.788 4.659-4.788 1.325 0 2.463.099 2.795.143v3.24l-1.918.001c-1.504 0-1.796.715-1.796 1.763v2.312h3.588l-.467 3.622h-3.12V24h6.116C23.406 24 24 23.406 24 22.674V1.326C24 .593 23.406 0 22.675 0z"/>
      </svg>
      Click to follow us
    </a>
  </div>

  <footer>
    <h3>About Us</h3>
    <p>MSTV Network is a non-profit platform offering free access to live TV channels, including entertainment, music, news, and more. We provide high-quality streaming to viewers worldwide, ensuring a diverse and engaging experience. Our mission is to make content from the Indian subcontinent accessible to everyone, fostering cultural exchange through free, reliable, and uninterrupted TV streaming.</p>
    <h3>Disclaimer</h3>
    <p>MSTV Network provides access to publicly available channels from various sources on the internet for informational and entertainment purposes only. We do not control or guarantee the accuracy, availability, or legality of the content streamed. All content is provided "as is," and MSTV Network is not liable for any errors, interruptions, or damages arising from the use of our services. By using MSTV Network, you agree to comply with all applicable laws. For more details, please refer to our Terms of Service and Privacy Policy.</p>
    <h3>Terms of Service</h3>
    <p>By using MSTV Network, you agree to comply with our terms of services...</p>
    <p class="copyright">© 2025 MSTV NETWORK. All rights reserved.</p>

  </footer>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="http://www.youtube.com/iframe_api"></script> 

  <script>
    // CHANNEL DATA: Add streams here easily
    const channelsByCategory = {
      news: [
        {name: "India Tv ", url: "https://pl-indiatvnews.akamaized.net/out/v1/db79179b608641ceaa5a4d0dd0dca8da/index.m3u8", logo: "logo.img/India-TV.png"},
        {name: "NDTV Hindi", url: "https://ndtvindiaelemarchana.akamaized.net/hls/live/2003679-b/ndtvindia/master.m3u8", logo: "logo.img/NDTV-India.png"},
        {name: "NDTV 24x7(English)", url: "https://ndtv24x7elemarchana.akamaized.net/hls/live/2003678-b/ndtv24x7/master.m3u8", logo: "logo.img/NDTV-24x7-1.png"},
        {name: "Aaj Tak Hd", url: "https://feeds.intoday.in/aajtak/api/aajtakhd/master.m3u8", logo: "logo.img/Aaj-Tak-HD.png"},
        {name: "India Today(English)", url: "https://feeds.intoday.in/hltapps/api/master.m3u8", logo: "logo.img/India_Today_icon.jpg"},
        {name: "Tv9 Bharatvarsh", url: "https://dyjmyiv3bp2ez.cloudfront.net/pub-iotv9hinjzgtpe/liveabr/playlist.m3u8", logo: "logo.img/TV9-Bharatvarsh.png"},
        {name: "News18 Pun/Him/Hary", url: "http://www.youtube.com/embed/g2J039U8S44", logo: "logo.img/N18PUNJ-200x300.webp"}, 
        {name: "Example YouTube 1", url: "http://www.youtube.com/embed/dQw4w9WgXcQ", logo: "https://via.placeholder.com/100?text=YT1"}, 
        {name: "Example YouTube 2", url: "http://www.youtube.com/embed/jfKfPtg0DxU", logo: "https://via.placeholder.com/100?text=YT2"}, 
        {name: "Example Twitch", url: "https://player.twitch.tv/?channel=esl_csgo", logo: "https://via.placeholder.com/100?text=Twitch"},
      ],
      music: [
        { name: "Music Channel", url: "http://www.youtube.com/embed/K9lE3e2G6iQ", logo: "https://via.placeholder.com/100?text=Music" }, 
        { name: "Music Twitch", url: "https://player.twitch.tv/?channel=monstercat", logo: "https://via.placeholder.com/100?text=MusicTwitch" }
      ],
      entertainment: [
        { name: "Entertainment News", url: "http://www.youtube.com/embed/TRA_K2o86-E", logo: "https://via.placeholder.com/100?text=Ent" } 
      ],
      sports: [
        { name: "Sports Twitch", url: "https://player.twitch.tv/?channel=ninja", logo: "https://via.placeholder.com/100?text=Sports" },
        { name: "Sports HLS", url: "https://test-streams.mux.dev/test_001/stream.m3u8", logo: "https://via.placeholder.com/100?text=SportsHLS" }
      ],
      religious: [
        { name: "Religious Channel", url: "http://www.youtube.com/embed/0I_5z8V6u2U", logo: "https://via.placeholder.com/100?text=Religious" } 
      ],
      international: [
        { name: "International Channel", url: "http://www.youtube.com/embed/jfKfPtg0DxU", logo: "https://via.placeholder.com/100?text=Intl" }
      ]
    };

    // Global variables
    let currentYouTubePlayer = null;
    let currentHtmlVideoPlayer = null; // To keep track of the HTML5 video player (for HLS or placeholder)
    let unmuteButton = document.getElementById('unmute-btn'); // Get the button element
    let isCurrentPlayerMuted = true; // Track mute state for our custom button logic

    // General DOM elements
    const categoriesContainer = document.getElementById('categories-container');
    const channelLogos = document.getElementById('channel-logos');
    const playerWrapper = document.getElementById('player-wrapper');
    const loading = document.getElementById('loading');
    const searchInput = document.getElementById('channel-search');
    const suggestionsBox = document.getElementById('suggestions');
    const mediaPlayerContainer = document.getElementById('media-player-container');
    const clickBlockOverlay = document.getElementById('click-block-overlay');
    const initialPlaceholderVideo = document.getElementById('initial-placeholder-video'); // Get the placeholder video element

    // Flatten channels for search suggestions
    const allChannels = Object.values(channelsByCategory).flat();

    // Create category buttons
    for (const category in channelsByCategory) {
      const btn = document.createElement('button');
      btn.textContent = capitalizeFirstLetter(category) + " Channels";
      btn.dataset.category = category;
      btn.onclick = () => showChannels(category);
      categoriesContainer.appendChild(btn);
    }

    function capitalizeFirstLetter(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function showChannels(category) {
      // Clear previous player and state
      playerWrapper.innerHTML = ''; // This will remove the initial placeholder video
      loading.style.display = 'none';
      suggestionsBox.style.display = 'none';
      searchInput.value = '';
      channelLogos.innerHTML = '';

      if (clickBlockOverlay) clickBlockOverlay.style.display = 'none';
      if (unmuteButton) {
        unmuteButton.style.display = 'none'; // Always hide initially
        unmuteButton.classList.remove('fade-out', 'hidden'); // Remove any lingering hide classes
        unmuteButton.style.animation = 'none'; // Clear animation for re-use
        void unmuteButton.offsetWidth; // Trigger reflow to clear animation state
      }
      currentYouTubePlayer = null; // Crucial: clear YouTube player reference
      currentHtmlVideoPlayer = null; // Clear HTML video player reference

      const filtered = channelsByCategory[category] || [];

      if (!filtered.length) {
        channelLogos.style.display = 'none';
        alert('No channels in this category');
        // If no channels, re-add placeholder video
        playerWrapper.appendChild(initialPlaceholderVideo);
        initialPlaceholderVideo.style.display = 'block';
        initialPlaceholderVideo.muted = true; // Ensure it's muted
        initialPlaceholderVideo.play().catch(e => console.warn("Placeholder video autoplay denied:", e));
        showUnmuteButtonForInitialVideo(); // Show unmute button for placeholder
        return;
      }

      filtered.forEach(ch => {
        const img = document.createElement('img');
        img.src = ch.logo;
        img.alt = ch.name + ' Logo';
        img.title = ch.name;
        img.dataset.url = ch.url;
        img.dataset.name = ch.name;
        img.style.borderColor = '#0ff';
        img.addEventListener('click', () => playStream(ch.url));
        channelLogos.appendChild(img);
      });

      channelLogos.style.display = 'flex';
    }

    function playStream(url) {
      loading.style.display = 'block';
      playerWrapper.innerHTML = ''; // Clear existing player content (including placeholder video)

      channelLogos.style.display = 'none';

      // --- CRUCIAL: Reset player states and hide button before determining type ---
      if (clickBlockOverlay) clickBlockOverlay.style.display = 'none';
      if (unmuteButton) {
          unmuteButton.style.display = 'none'; // Always hide initially
          unmuteButton.classList.remove('fade-out', 'hidden'); // Remove any lingering hide classes
          unmuteButton.style.animation = 'none'; // Clear animation for re-use
          void unmuteButton.offsetWidth; // Trigger reflow to clear animation state
      }
      currentYouTubePlayer = null; // Clear YouTube player reference
      currentHtmlVideoPlayer = null; // Clear HTML video player reference
      isCurrentPlayerMuted = true; // Assume new stream starts muted
      // --- END CRUCIAL RESET ---

      const streamType = detectStreamType(url);
      
      if (streamType === 'hls') {
        const video = document.createElement('video');
        video.autoplay = true;
        video.muted = true; // Start muted for HLS too, helps with autoplay policies
        video.controls = false; // <<< REMOVED CONTROLS
        video.playsInline = true;
        video.className = 'media-player';
        video.setAttribute('playsinline', '');
        video.setAttribute('autoplay', '');
        video.setAttribute('muted', ''); 
        playerWrapper.appendChild(video);
        currentHtmlVideoPlayer = video; // Assign to currentHtmlVideoPlayer

        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.play().then(() => {
                isCurrentPlayerMuted = video.muted;
                updateUnmuteButtonVisibility(); // Check and update button
                loading.style.display = 'none';
            }).catch(err => {
                console.warn("HLS Autoplay error (muted start, requires click to unmute):", err);
                loading.innerText = "Click to start stream (unmute)";
                loading.style.cursor = "pointer";
                loading.onclick = () => {
                  video.play();
                  video.muted = false; // Unmute on user click
                  isCurrentPlayerMuted = false;
                  updateUnmuteButtonVisibility();
                  loading.style.display = 'none';
                  loading.style.cursor = "default";
                  loading.onclick = null;
                };
                showUnmuteButtonForHtmlVideo(); // Show button if autoplay fails and is muted
            });
          });
          hls.on(Hls.Events.ERROR, function (event, data) {
            console.error("HLS.js error:", data);
            loading.innerText = 'Error loading stream.';
            unmuteButton.style.display = 'none'; // Hide if stream errors
          });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = url;
          video.addEventListener('loadedmetadata', () => {
            video.play().then(() => {
                isCurrentPlayerMuted = video.muted;
                updateUnmuteButtonVisibility();
                loading.style.display = 'none';
            }).catch(err => {
                console.warn("HLS Native Autoplay error (muted start, requires click to unmute):", err);
                loading.innerText = "Click to start stream (unmute)";
                loading.style.cursor = "pointer";
                loading.onclick = () => {
                  video.play();
                  video.muted = false;
                  isCurrentPlayerMuted = false;
                  updateUnmuteButtonVisibility();
                  loading.style.display = 'none';
                  loading.style.cursor = "default";
                  loading.onclick = null;
                };
                showUnmuteButtonForHtmlVideo();
            });
          });
        } else {
          loading.innerText = 'HLS not supported in this browser.';
          unmuteButton.style.display = 'none';
        }
      } else {
        // For iframes (YouTube, Twitch, etc.)
        const iframe = document.createElement('iframe');
        iframe.className = "media-player";
        iframe.style.width = "100%";
        iframe.style.height = "100%";
        iframe.style.aspectRatio = "16 / 9";
        iframe.frameBorder = "0";
        iframe.allowFullscreen = false; 

        // Set 'allow' attribute broadly for non-YouTube iframes that might try to autoplay
        iframe.setAttribute('allow', 'autoplay; encrypted-media; fullscreen;'); 

        if (streamType === 'youtube') {
          const ytId = getYouTubeId(url);
          if (ytId) {
              iframe.id = 'youtube-player-iframe'; // Unique ID for YouTube API
              // controls=0, fs=0, modestbranding=1, rel=0 to hide elements
              iframe.src = `http://www.youtube.com/embed/${ytId}?enablejsapi=1&autoplay=1&mute=1&controls=0&fs=0&disablekb=1&modestbranding=1&rel=0&iv_load_policy=3`;
              iframe.setAttribute('allow', 'autoplay; encrypted-media; fullscreen;'); 
          } else {
              console.error("Invalid YouTube URL:", url);
              loading.innerText = 'Invalid YouTube URL.';
              return;
          }
        } else if (streamType === 'twitch') {
            iframe.src = `https://player.twitch.tv/?channel=${getTwitchChannel(url)}&parent=${window.location.hostname}&autoplay=true&muted=true`;
            iframe.setAttribute('allow', 'autoplay; encrypted-media; fullscreen;');
        } else {
          iframe.src = url; // Generic iframe
        }

        playerWrapper.appendChild(iframe);
        loading.style.display = 'none';

        // Show the transparent overlay to block clicks for iframes
        if (clickBlockOverlay) {
            clickBlockOverlay.style.display = 'block';
        }

        // --- Handle YouTube API when iframe is ready for YouTube streams ONLY ---
        if (streamType === 'youtube') {
            // This global function is called by the YouTube IFrame API script when it loads.
            // We need to re-assign it every time we might create a new player.
            window.onYouTubeIframeAPIReady = function() {
                if (currentYouTubePlayer) {
                    try { currentYouTubePlayer.destroy(); } catch (e) { console.warn("Error destroying old YT player:", e); }
                    currentYouTubePlayer = null;
                }
                currentYouTubePlayer = new YT.Player('youtube-player-iframe', {
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            };
            // If the API script was already loaded (e.g., this is not the first YT video played)
            // and the iframe is now in the DOM, manually call onYouTubeIframeAPIReady.
            // Ensure the iframe has an ID for YT.Player to find it.
            if (typeof YT !== 'undefined' && YT.Player && document.getElementById('youtube-player-iframe')) {
                 window.onYouTubeIframeAPIReady();
            }
        }
      }
    }

    function detectStreamType(url) {
      if (url.includes("youtube.com/embed/")) return "youtube"; // Direct embed URL
      // More generic check for youtube video IDs in typical URLs
      if (url.includes("youtube.com/watch?v=") || url.includes("youtu.be/")) return "youtube";
      if (url.includes("twitch.tv")) return "twitch";
      if (url.endsWith(".m3u8")) return "hls";
      return "iframe"; // Generic iframe for other URLs
    }

    function getYouTubeId(url) {
      // Regex to extract YouTube ID from various YouTube URLs
      const match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
      return (match && match[1]) ? match[1] : null;
    }

    function getTwitchChannel(url) {
      try {
        const urlObj = new URL(url);
        const pathParts = urlObj.pathname.split('/');
        return pathParts[pathParts.length - 1];
      } catch {
        return '';
      }
    }

    // --- YOUTUBE API FUNCTIONS ---
    function onPlayerReady(event) {
        event.target.mute(); // Ensure it's muted on ready
        event.target.playVideo(); // Attempt to play

        isCurrentPlayerMuted = true; // Set our internal flag
        updateUnmuteButtonVisibility(); // Show button if muted
        loading.style.display = 'none';
    }

    function onPlayerStateChange(event) {
        if (currentYouTubePlayer && unmuteButton) {
            // Check mute state from the player directly
            isCurrentPlayerMuted = currentYouTubePlayer.isMuted();

            if (event.data === YT.PlayerState.PLAYING && !isCurrentPlayerMuted) {
                // If playing and unmuted, hide button with fade-out
                unmuteButton.classList.add('fade-out');
                unmuteButton.addEventListener('animationend', function handler() {
                    unmuteButton.classList.add('hidden');
                    unmuteButton.removeEventListener('animationend', handler);
                    unmuteButton.style.animation = 'none';
                }, {once: true});
            } else if (isCurrentPlayerMuted || event.data !== YT.PlayerState.PLAYING) {
                // If muted, or if not playing (paused, buffering, cued), show button (pulse glow)
                unmuteButton.style.display = 'flex';
                unmuteButton.classList.remove('fade-out', 'hidden');
                unmuteButton.style.animation = 'pulseGlow 1.5s infinite alternate';
            }
        }
    }

    // Universal toggle mute function for both HTML5 video and YouTube
    function toggleMute() {
        if (currentYouTubePlayer) {
            if (currentYouTubePlayer.isMuted()) {
                currentYouTubePlayer.unMute();
                console.log('YouTube player unmuted.');
                isCurrentPlayerMuted = false;
            } else {
                currentYouTubePlayer.mute();
                console.log('YouTube player muted.');
                isCurrentPlayerMuted = true;
            }
        } else if (currentHtmlVideoPlayer) {
            currentHtmlVideoPlayer.muted = !currentHtmlVideoPlayer.muted;
            isCurrentPlayerMuted = currentHtmlVideoPlayer.muted;
            console.log('HTML video player muted:', isCurrentPlayerMuted);
        } else if (initialPlaceholderVideo && initialPlaceholderVideo.isConnected) {
            // Handle the initial placeholder video specifically
            initialPlaceholderVideo.muted = !initialPlaceholderVideo.muted;
            isCurrentPlayerMuted = initialPlaceholderVideo.muted;
            console.log('Placeholder video muted:', isCurrentPlayerMuted);
        } else {
            console.warn("No active player to mute/unmute.");
            return; // Exit if no player found
        }
        updateUnmuteButtonVisibility(); // Update button after mute state change
    }

    function updateUnmuteButtonVisibility() {
        if (unmuteButton) {
            if (isCurrentPlayerMuted) {
                unmuteButton.style.display = 'flex'; // Show it
                unmuteButton.classList.remove('fade-out', 'hidden'); // Remove any hide classes
                unmuteButton.style.animation = 'pulseGlow 1.5s infinite alternate'; // Restart pulsing
            } else {
                // If unmuted, hide it with fade-out
                unmuteButton.classList.add('fade-out');
                unmuteButton.addEventListener('animationend', function handler() {
                    unmuteButton.classList.add('hidden');
                    unmuteButton.removeEventListener('animationend', handler);
                    unmuteButton.style.animation = 'none';
                }, {once: true});
            }
        }
    }

    // Specifically for when the initial placeholder video is loaded
    function showUnmuteButtonForInitialVideo() {
        if (unmuteButton && initialPlaceholderVideo && initialPlaceholderVideo.muted) {
             unmuteButton.style.display = 'flex';
             unmuteButton.classList.remove('fade-out', 'hidden');
             unmuteButton.style.animation = 'pulseGlow 1.5s infinite alternate';
             isCurrentPlayerMuted = true;
        } else if (unmuteButton) { // If for some reason it's not muted, hide it
            unmuteButton.style.display = 'none';
        }
    }

    // Specifically for when an HTML5 video (HLS) is loaded and needs muting
    function showUnmuteButtonForHtmlVideo() {
         if (unmuteButton && currentHtmlVideoPlayer && currentHtmlVideoPlayer.muted) {
             unmuteButton.style.display = 'flex';
             unmuteButton.classList.remove('fade-out', 'hidden');
             unmuteButton.style.animation = 'pulseGlow 1.5s infinite alternate';
             isCurrentPlayerMuted = true;
        } else if (unmuteButton) {
            unmuteButton.style.display = 'none';
        }
    }

    // Search bar functionality with suggestions (unchanged)
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.trim().toLowerCase();
      suggestionsBox.innerHTML = '';
      if (query) {
        const filteredSuggestions = allChannels.filter(channel => 
          channel.name.toLowerCase().includes(query)
        );
        filteredSuggestions.forEach(channel => {
          const div = document.createElement('div');
          div.textContent = channel.name;
          div.onclick = () => {
            searchInput.value = channel.name;
            suggestionsBox.style.display = 'none';
            playStream(channel.url);
          };
          suggestionsBox.appendChild(div);
        });
        suggestionsBox.style.display = filteredSuggestions.length > 0 ? 'block' : 'none';
      } else {
        suggestionsBox.style.display = 'none';
      }
    });

    // Close suggestions if clicked outside
    document.addEventListener('click', (event) => {
      if (!searchInput.contains(event.target) && !suggestionsBox.contains(event.target)) {
        suggestionsBox.style.display = 'none';
      }
    });

    function searchSelected() {
        const query = searchInput.value.trim().toLowerCase();
        const foundChannel = allChannels.find(channel => channel.name.toLowerCase() === query);
        if (foundChannel) {
            playStream(foundChannel.url);
        } else {
            alert('Channel not found.');
        }
        suggestionsBox.style.display = 'none';
    }

    // Initialize the default player and speaker button on load
    document.addEventListener('DOMContentLoaded', () => {
        // Ensure the initial placeholder video is in the player-wrapper and visible
        playerWrapper.innerHTML = ''; // Clear anything that might be there
        playerWrapper.appendChild(initialPlaceholderVideo);
        initialPlaceholderVideo.style.display = 'block'; // Make sure it's visible
        initialPlaceholderVideo.muted = true; // Crucial: ensure it's muted
        initialPlaceholderVideo.play().catch(e => {
            console.warn("Placeholder video autoplay denied:", e);
            // If autoplay is denied, the video might show a play button, but it will be visible.
        });
        isCurrentPlayerMuted = true; // Set flag for placeholder
        showUnmuteButtonForInitialVideo(); // Show the button for the placeholder
    });
  </script>
</body>
</html>
