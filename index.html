<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Media Player</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            text-align: center;
            margin-top: 50px; /* Space from top */
        }
        .player-container {
            display: none; /* Hidden by default */
            border-radius: 8px;
            overflow: hidden; /* Ensures rounded corners on embeds */
            background-color: #000; /* Background for players */
            aspect-ratio: 16 / 9; /* Common video aspect ratio */
            width: 100%;
            max-width: 800px; /* Max width for players */
            margin: 20px auto 0 auto; /* Center player below dropdown */
        }
        .player-container iframe,
        .player-container video {
            width: 100%;
            height: 100%;
            border: none;
        }
        .dropdown {
            margin-bottom: 20px;
            width: 100%;
            max-width: 400px; /* Max width for dropdown */
            margin-left: auto;
            margin-right: auto;
        }
        .unmute-button {
            background-color: #1c64f2;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: background-color 0.2s ease;
        }
        .unmute-button:hover {
            background-color: #1a56cc;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                margin-top: 20px;
                padding: 16px;
            }
            .player-container {
                margin-top: 15px;
            }
            .dropdown {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Channel Selector</h1>

        <!-- Dropdown for Channels -->
        <div class="dropdown">
            <label for="channel-select" class="block text-gray-700 text-sm font-bold mb-2">Select a Channel:</label>
            <select id="channel-select" class="block appearance-none w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 pr-8 rounded-lg shadow leading-tight focus:outline-none focus:shadow-outline transition duration-200 ease-in-out">
                <option value="">-- Please choose a channel --</option>
                <option value="https://youtube.com/playlist?list=PLLQwHVFP77cHMXsTkwOnaamkqPVcFuEat&si=zvYidx_XxDKkK5Wa">My YouTube Playlist (Ch. 2)</option>
                <option value="twitch-stream">Twitch Gaming Stream</option>
                <option value="m3u8-stream">Live M3U8 Stream</option>
                <option value="external-html">External HTML Page</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.757 7.586 5.343 9z"/></svg>
            </div>
        </div>

        <!-- Player Containers -->

        <!-- YouTube Playlist Player -->
        <div id="youtube-playlist-player" class="player-container">
            <div id="youtube-player-iframe"></div>
            <button id="youtube-unmute-button" class="unmute-button">Unmute Video</button>
            <p class="text-sm text-gray-500 mt-2">
                Note: Videos may start muted due to browser autoplay policies. Click "Unmute Video" to enable sound.
            </p>
        </div>

        <!-- Twitch Stream Player -->
        <div id="twitch-stream-player" class="player-container">
            <iframe
                src="https://player.twitch.tv/?channel=twitchdev&parent=localhost&autoplay=true"
                allowfullscreen
                loading="lazy">
            </iframe>
        </div>

        <!-- M3U8 Stream Player -->
        <div id="m3u8-stream-player" class="player-container">
            <video controls autoplay muted playsinline>
                <source src="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" type="application/x-mpegURL">
                Your browser does not support the video tag or HLS streams directly. For broader compatibility,
                a JavaScript library like HLS.js is often used (not included here).
            </video>
        </div>

        <!-- External HTML Page Embed -->
        <div id="external-html-player" class="player-container">
            <iframe src="https://www.example.com" loading="lazy"></iframe>
        </div>
    </div>

    <!-- YouTube IFrame Player API Script -->
    <script>
        // Load the IFrame Player API code asynchronously.
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var youtubePlayer; // Global variable for YouTube player

        // This function creates an <iframe> (and YouTube player)
        // after the API code downloads.
        function onYouTubeIframeAPIReady() {
            // YouTube player will be initialized when the channel is selected
            // to avoid loading if not needed.
        }

        // Function to handle YouTube player readiness
        function onYouTubePlayerReady(event) {
            // Unmute the player when it's ready, if it's currently muted
            if (youtubePlayer && youtubePlayer.isMuted()) {
                youtubePlayer.unMute();
            }
            // Hide the unmute button once the video can be unmuted
            document.getElementById('youtube-unmute-button').style.display = 'none';
        }

        // Event listener for the custom unmute button
        document.getElementById('youtube-unmute-button').addEventListener('click', function() {
            if (youtubePlayer) {
                if (youtubePlayer.isMuted()) {
                    youtubePlayer.unMute();
                }
                // Optional: set volume to max after unmuting
                youtubePlayer.setVolume(100);
            }
            this.style.display = 'none'; // Hide button after click
        });

        const channelSelect = document.getElementById('channel-select');
        const playerContainers = document.querySelectorAll('.player-container');

        // Your YouTube playlist ID
        const MY_YOUTUBE_PLAYLIST_ID = 'PLLQwHVFP77cHMXsTkwOnaamkqPVcFuEat'; // Your playlist ID

        channelSelect.addEventListener('change', function() {
            const selectedChannel = this.value;

            // Hide all player containers first
            playerContainers.forEach(container => {
                container.style.display = 'none';
            });

            // Stop any playing video/stream before switching
            // This is a basic stop for HTML5 video, YouTube/Twitch have their own API methods
            document.querySelectorAll('video').forEach(video => {
                video.pause();
                video.currentTime = 0;
            });

            // Specific logic for each channel type
            if (selectedChannel === 'youtube-playlist') {
                const youtubePlayerContainer = document.getElementById('youtube-playlist-player');
                youtubePlayerContainer.style.display = 'block';

                // Only create/load YouTube player if it doesn't exist or needs reloading
                if (!youtubePlayer) {
                    youtubePlayer = new YT.Player('youtube-player-iframe', {
                        height: '100%',
                        width: '100%',
                        playerVars: {
                            listType: 'playlist',
                            list: MY_YOUTUBE_PLAYLIST_ID,
                            autoplay: 1, // Autoplay, but might be muted by browser
                            controls: 1, // Ensure controls are visible
                            mute: 1, // Start muted to comply with autoplay policies
                            enablejsapi: 1, // Enable JavaScript API
                            iv_load_policy: 3, // Don't show video annotations
                            loop: 1 // Loop the playlist
                        },
                        events: {
                            'onReady': onYouTubePlayerReady,
                            'onStateChange': function(event) {
                                // If the video starts playing and is muted, make the unmute button visible
                                if (event.data == YT.PlayerState.PLAYING && youtubePlayer.isMuted()) {
                                    document.getElementById('youtube-unmute-button').style.display = 'block';
                                } else if (event.data == YT.PlayerState.PLAYING && !youtubePlayer.isMuted()) {
                                    // If playing and unmuted, hide the button
                                    document.getElementById('youtube-unmute-button').style.display = 'none';
                                }
                            }
                        }
                    });
                } else {
                    // Load the playlist if player already exists
                    youtubePlayer.loadPlaylist({
                        list: MY_YOUTUBE_PLAYLIST_ID,
                        listType: 'playlist',
                        index: 0, // Start from the first video
                        startSeconds: 0
                    });
                    youtubePlayer.mute(); // Ensure it starts muted for autoplay
                    document.getElementById('youtube-unmute-button').style.display = 'block'; // Show unmute button
                }
            } else if (selectedChannel === 'twitch-stream') {
                const twitchPlayerContainer = document.getElementById('twitch-stream-player');
                twitchPlayerContainer.style.display = 'block';
                // Twitch embeds typically autoplay if allowed and require user interaction for sound.
                // The iframe src itself handles most of this.
            } else if (selectedChannel === 'm3u8-stream') {
                const m3u8PlayerContainer = document.getElementById('m3u8-stream-player');
                m3u8PlayerContainer.style.display = 'block';
                const videoElement = m3u8PlayerContainer.querySelector('video');
                // Ensure video starts playing and is muted initially for autoplay
                videoElement.play().catch(error => {
                    console.error("Autoplay was prevented for M3U8 stream:", error);
                    // You might want to show a message to the user here
                });
                videoElement.muted = true; // Ensure it starts muted
                // For a robust HLS player (m3u8), a library like HLS.js is usually required for cross-browser compatibility.
                // Modern browsers might play it natively in the <video> tag.
            } else if (selectedChannel === 'external-html') {
                const externalHtmlPlayerContainer = document.getElementById('external-html-player');
                externalHtmlPlayerContainer.style.display = 'block';
                // The iframe src is already set to example.com.
            }
        });

        // Initialize with no player visible, or a default one
        document.addEventListener('DOMContentLoaded', () => {
            channelSelect.value = ""; // Reset dropdown on load
            playerContainers.forEach(container => {
                container.style.display = 'none';
            });
        });
    </script>
</body>
</html>
