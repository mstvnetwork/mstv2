<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embedded Stream Player</title>
    <style>
        /* --- CSS STYLES --- */
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            color: #333;
        }

        #player-container {
            width: 90%; /* Adjust as needed */
            max-width: 960px; /* Max width for the player */
            margin-bottom: 20px;
            background-color: black; /* To make the video area visible */
            border-radius: 8px;
            overflow: hidden; /* Ensures iframe or video respects border-radius */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        video {
            width: 100%;
            height: auto;
            display: block; /* Remove extra space below video */
        }

        iframe {
            width: 100%;
            height: 500px; /* Or adjust dynamically if possible */
            border: none;
            display: block;
        }

        #channel-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 15px;
            gap: 10px; /* Space between buttons */
        }

        #channel-selector button {
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        #channel-selector button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        #channel-selector button:active {
            background-color: #004085;
            transform: translateY(0);
        }

        /* Basic responsive adjustments */
        @media (max-width: 768px) {
            #player-container {
                width: 95%;
            }
            #channel-selector button {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="player-container">
        <video id="videoPlayer" controls autoplay></video>
    </div>

    <div id="channel-selector">
        <button onclick="loadChannel(1)">Channel 1 (Live HLS)</button>
        <button onclick="loadChannel(2)">Channel 2 (Live HLS)</button>
        <button onclick="loadChannel(3)">Channel 3 (HTML Embed)</button>
        <button onclick="loadChannel(4)">Channel 4 (M3U8 Playlist)</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        /* --- JAVASCRIPT LOGIC --- */
        const video = document.getElementById('videoPlayer');
        let hls; // Declare hls variable globally to manage its instance

        // Define your channel configurations
        const channels = {
            1: {
                type: 'hls',
                url: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8' // Example live HLS URL (Mux test stream)
            },
            2: {
                type: 'hls',
                url: 'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8' // Another example live HLS URL
            },
            3: {
                type: 'html-embed',
                // IMPORTANT: Replace with your actual HTML page to embed.
                // Ensure this page allows embedding (e.g., no X-Frame-Options: DENY).
                url: 'https://www.google.com/about/products/' // Example - will likely fail due to X-Frame-Options
                // Try a simpler page you control: 'https://example.com' or 'https://yourdomain.com/some_embedded_page.html'
            },
            4: {
                type: 'playlist',
                urls: [
                    'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
                    'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',
                    // Add more M3U8 URLs to your playlist
                    // 'https://devstreaming-cdn.apple.com/videos/streaming/examples/img_bipbop_adv_example_fmp4/master.m3u8'
                ],
                currentIndex: 0,
                autoplay: true,
            }
        };

        let currentChannel = null;
        let playlistInterval = null; // To manage playlist progression

        function loadChannel(channelNum) {
            // Clean up previous HLS instance if it exists
            if (hls) {
                hls.destroy();
                hls = null;
            }

            // Clear any existing playlist intervals
            if (playlistInterval) {
                clearInterval(playlistInterval);
                playlistInterval = null;
            }

            const playerContainer = document.getElementById('player-container');
            const videoElement = document.getElementById('videoPlayer');

            currentChannel = channels[channelNum];

            if (!currentChannel) {
                console.error('Channel not found:', channelNum);
                return;
            }

            // Reset player container to ensure correct element for video/iframe
            if (currentChannel.type !== 'html-embed') {
                 // If not HTML embed, ensure we have the video element
                if (!videoElement) {
                     playerContainer.innerHTML = `<video id="videoPlayer" controls autoplay></video>`;
                }
                document.getElementById('videoPlayer').style.display = 'block'; // Ensure video is visible
            } else {
                 // If HTML embed, we will replace the content, so make sure video is not there
                 playerContainer.innerHTML = ''; // Clear existing content
            }


            if (currentChannel.type === 'hls') {
                const currentVideoElement = document.getElementById('videoPlayer'); // Get the video element after potential recreation
                if (Hls.isSupported()) {
                    hls = new Hls();
                    hls.loadSource(currentChannel.url);
                    hls.attachMedia(currentVideoElement);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        currentVideoElement.play();
                    });
                    hls.on(Hls.Events.ERROR, function (event, data) {
                        if (data.fatal) {
                            switch(data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    console.error("fatal network error encountered, trying to recover", data);
                                    hls.startLoad();
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    console.error("fatal media error encountered, trying to recover", data);
                                    hls.recoverMediaError();
                                    break;
                                default:
                                    console.error("fatal error encountered, destroying HLS", data);
                                    hls.destroy();
                                    break;
                            }
                        }
                    });
                } else if (currentVideoElement.canPlayType('application/vnd.apple.mpegurl')) {
                    currentVideoElement.src = currentChannel.url;
                    currentVideoElement.addEventListener('loadedmetadata', function() {
                        currentVideoElement.play();
                    });
                } else {
                    alert('Your browser does not support HLS directly.');
                }
            } else if (currentChannel.type === 'html-embed') {
                // For HTML embed, replace the video player with an iframe
                playerContainer.innerHTML = `<iframe src="${currentChannel.url}" frameborder="0" allowfullscreen></iframe>`;
                // No video element to hide here as we replaced the content
            } else if (currentChannel.type === 'playlist') {
                currentChannel.currentIndex = 0; // Reset playlist index
                const currentVideoElement = document.getElementById('videoPlayer'); // Get the video element after potential recreation
                loadPlaylistVideo(currentVideoElement, currentChannel);
                setupPlaylistListener(currentVideoElement, currentChannel);
            }
        }

        function loadPlaylistVideo(videoElement, playlistConfig) {
            if (playlistConfig.currentIndex >= playlistConfig.urls.length) {
                console.log('Playlist finished, looping.');
                playlistConfig.currentIndex = 0; // Loop the playlist
            }

            const currentUrl = playlistConfig.urls[playlistConfig.currentIndex];
            console.log(`Playing playlist item ${playlistConfig.currentIndex + 1}/${playlistConfig.urls.length}: ${currentUrl}`);

            if (hls) {
                hls.destroy();
                hls = null;
            }

            if (Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(currentUrl);
                hls.attachMedia(videoElement);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    videoElement.play();
                });
                hls.on(Hls.Events.ERROR, function (event, data) {
                    console.error("HLS playlist error for item:", currentUrl, data);
                    // Attempt to move to the next item on error
                    playlistConfig.currentIndex++;
                    loadPlaylistVideo(videoElement, playlistConfig);
                });
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = currentUrl;
                videoElement.addEventListener('loadedmetadata', function() {
                    videoElement.play();
                });
            } else {
                alert('Your browser does not support HLS for playlist playback.');
            }
        }

        function setupPlaylistListener(videoElement, playlistConfig) {
            // Remove any existing 'ended' listeners to prevent duplicates
            videoElement.removeEventListener('ended', handlePlaylistEnded);
            videoElement.addEventListener('ended', handlePlaylistEnded);

            function handlePlaylistEnded() {
                playlistConfig.currentIndex++;
                loadPlaylistVideo(videoElement, playlistConfig);
            }
        }

        // Initial load when the page is ready
        document.addEventListener('DOMContentLoaded', () => {
            loadChannel(1); // Load Channel 1 by default when the page loads
        });
    </script>
</body>
</html>
